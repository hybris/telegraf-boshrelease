---
name: telegraf

packages:
  - telegraf

templates:
  config/telegraf.conf.erb: config/telegraf.conf
  bin/monit_debugger: bin/monit_debugger
  data/properties.sh.erb: data/properties.sh
  bin/ctl: bin/ctl
  helpers/ctl_setup.sh: helpers/ctl_setup.sh
  helpers/ctl_utils.sh: helpers/ctl_utils.sh

properties:
  telegraf.conf:
    default: ""
    description: "The contents of telegraf.conf (telegraf's configuration file)"

  # Tags
  telegraf.tags:
    default: |2
      dc = "us-east-1"
      deployment = "telegraf"
      team = "idefix"
    description: Default tag configuration
  # Agent
  telegraf.interval:
    default: 10s
    description: Default data collection interval for all inputs
  telegraf.round_interval:
    default: true
    description: Rounds collection interval to 'interval'
  telegraf.collection_jitter:
    default: 2s
    description: Rounds collection interval to 'interval'
  telegraf.flush_interval:
    default: 10s
    description: Default data flushing interval for all outputs. You should not set this below interval. Maximum flush_interval will be flush_interval + flush_jitter
  telegraf.flush_jitter:
    default: 5s
    description: Jitter the flush interval by a random amount.
  telegraf.precision:
    default: s
    description: Precision.

  ### Outputs
  # Influxdb output:
  telegraf.outputs.inxluxdb.urls:
    default: '["http://localhost:8086"]'
    description: |
      The full HTTP or UDP endpoint URL for your InfluxDB instance.
      Multiple urls can be specified as part of the same cluster,
      this means that only ONE of the urls will be written to each interval.
  telegraf.outputs.inxluxdb.database:
    default: "Backingservices"
    description: The target database for metrics (telegraf will create it if not exists).
  telegraf.outputs.inxluxdb.retention_policy:
    default: ""
    description: Retention policy to write to. Empty string writes to the default rp.
  telegraf.outputs.inxluxdb.write_consistency:
    default: "any"
    description: 'Write consistency (clusters only), can be: "any", "one", "quorum", "all"'
  telegraf.outputs.inxluxdb.timeout:
    default: "5s"
    description: If not provided, will default to 5s. 0s means no timeout (not recommended).
  telegraf.outputs.inxluxdb.username:
    default: "secret"
  telegraf.outputs.inxluxdb.password:
    default: "secret"
  telegraf.outputs.inxluxdb.user_agent:
    default: ""
    description: Set the user agent for HTTP POSTs (can be useful for log differentiation) e.g.:telegraf
  telegraf.outputs.inxluxdb.udp_payload:
    default: ""
    description: Set UDP payload size, defaults to InfluxDB UDP Client default (512 bytes)

  # statsd input:
  telegraf.inputs.statsd.enabled:
    default: false
    description: Delete gauges every interval (default=false)
  telegraf.inputs.statsd.service_address:
    default: ":8125"
    description: Address and port to host UDP listener on
  telegraf.inputs.statsd.delete_gauges:
    default: true
    description: Delete gauges every interval (default=false)
  telegraf.inputs.statsd.delete_counters:
    default: true
    description: Delete counters every interval (default=false)
  telegraf.inputs.statsd.delete_sets:
    default: true
    description: Delete sets every interval (default=false)
  telegraf.inputs.statsd.delete_timings:
    default: true
    description: Delete timings & histograms every interval (default=true)
  telegraf.inputs.statsd.percentiles:
    default: [90]
    description: Percentiles to calculate for timing & histogram stats
  telegraf.inputs.statsd.metric_separator:
    default: "_"
    description: separator to use between elements of a statsd metric
  telegraf.inputs.statsd.parse_data_dog_tags:
    default: false
    description: |
      Parses tags in the datadog statsd format
      http://docs.datadoghq.com/guides/dogstatsd/
  telegraf.inputs.statsd.allowed_pending_messages:
    default: 10000
    description: |
      Number of UDP messages allowed to queue up, once filled,
      the statsd server will start dropping packets"
  telegraf.inputs.statsd.percentile_limit:
    default: 1000
    description: |
      Number of timing/histogram values to track per-measurement in the
      calculation of percentiles. Raising this limit increases the accuracy
      of percentiles but also increases the memory usage and cpu time.
